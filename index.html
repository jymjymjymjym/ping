<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <canvas width="800" height="600" id="ping"></canvas>
  <script src="./lib/util.js"></script>
  <script>
    const canvas = document.querySelector('#ping')
    const ctx = canvas.getContext('2d')

    const minAngel = 60, maxAngel = 300
    let curAngel = 60

    function drawArc() {
      ctx.save()
      ctx.beginPath();
      ctx.translate(200, 150);

      const lineargradient = ctx.createLinearGradient(-30, 0, 30, 0);
      lineargradient.addColorStop(0, 'blue');
      lineargradient.addColorStop(1, 'red');
      ctx.strokeStyle = lineargradient;
      ctx.lineWidth = 10

      ctx.arc(0, 0, 100, Math.PI / 3, Math.PI / 6 + Math.PI / 2, true);
      ctx.stroke();
      ctx.clearRect(-60, 50, 120, 100)

      ctx.restore()
      console.log(ctx);
    }

    function drawGrad() {

      ctx.save()

      ctx.beginPath();
      ctx.translate(200, 150);
      ctx.strokeStyle = 'black'
      ctx.lineWidth = 1

      ctx.rotate(Math.PI / 6)
      for (let i = 0; i < 9; i++) {
        ctx.rotate(Math.PI / 6)
        ctx.moveTo(0, 100);
        ctx.lineTo(0, 90);
      }
        ctx.stroke()
      ctx.restore()

    }

    function drawText() {
      ctx.save()

      ctx.translate(200, 150);
      ctx.font = "18px serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle"
      ctx.strokeStyle = 'black'
      ctx.lineWidth = 1

      let angel = Math.PI / 6
      for (let i = 0; i < 9; i++) {
        const x = 80 * Math.cos(angel * i + Math.PI / 2 + Math.PI / 3)
        const y = 80 * Math.sin(angel * i + Math.PI / 2 + Math.PI / 3)
        ctx.fillText(i, x, y);
      }
      ctx.restore()
    }

    function drawIndicator() {
      ctx.save()
      ctx.translate(200, 150);
      if (curAngel > maxAngel) {
        curAngel = maxAngel
      }

      if (curAngel < minAngel) {
        curAngel = minAngel
      }

      ctx.rotate(deg(curAngel))
      ctx.moveTo(-5, 0)
      ctx.lineTo(0, 70)
      ctx.lineTo(5, 0)
      ctx.quadraticCurveTo(0, -5 / 2, -5, 0);
      ctx.closePath();
      
      ctx.lineWidth = 1
      ctx.fillStyle = 'black'
      ctx.fill()

      ctx.restore()
    }


    document.onkeypress = (e) => {
      if (e.keyCode === 32) {
        curAngel++
        console.log(1);
      }
    }

    document.onkeyup = (e) => {
      curAngel = 0
    }


    (function animation() {

      ctx.clearRect(0, 0, 1900, 1900)
      drawGrad()
      drawIndicator();
      drawText();
      drawArc()

      requestAnimationFrame(animation)
    })()
  </script>
</body>

</html>